{"version":3,"file":"static/js/90.aabfe0f6.chunk.js","mappings":"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","sources":["App/pages/Projects/projects/WaText/components/DataGrids.jsx","App/pages/Projects/projects/WaText/components/MostUsedWords.jsx"],"sourcesContent":["import React from \"react\";\n\nimport {\n  GridToolbarContainer,\n  GridToolbarExport,\n  GridToolbarColumnsButton,\n  GridToolbarFilterButton,\n  GridToolbarDensitySelector,\n} from '@mui/x-data-grid';\n\nconst CustomToolbar = () => {\n  return (\n    <GridToolbarContainer>\n      <GridToolbarColumnsButton color=\"info\" />\n      <GridToolbarFilterButton style={{ color: '#2196f3' }} />\n      <GridToolbarDensitySelector color=\"info\" />\n      <GridToolbarExport color=\"info\" />\n    </GridToolbarContainer>\n  );\n}\n\nexport { CustomToolbar };","import React, { useState } from \"react\";\n\nimport Divider from '@mui/material/Divider';\nimport Typography from \"@mui/material/Typography\";\nimport { Grid, IconButton, ToggleButton, Tooltip } from \"@mui/material\";\nimport HelpIcon from '@mui/icons-material/Help';\n\nimport { DataGrid } from '@mui/x-data-grid';\n\nimport { CustomToolbar } from \"./DataGrids\";\n\nconst WORDS_IN_TABLE_PER_SENDER = 20;\nconst WORDS_IN_TABLE_TOTAL = 100;\n\nconst textDfToWordCount = (textDf) => {\n  let wordCount = { '': {} };\n  let totalCharacters = { '': 0 };\n  textDf.forEach(message => {\n    const sender = message.sender;\n    if (message.type === \"plainText\" && sender !== \"\") {\n      if (!(sender in wordCount)) {\n        totalCharacters[sender] = 0;\n        wordCount[sender] = {};\n      }\n      const words = message.message\n        .split(/\\W/)\n        .map(w => w.toLowerCase())\n        .filter(w => w !== '');\n      words.forEach(w => wordCount[sender][w] = (wordCount[sender][w] || 0) + 1);\n      words.forEach(w => wordCount[''][w] = (wordCount[''][w] || 0) + 1);\n\n      totalCharacters[sender] += message.message.length;\n      totalCharacters[''] += message.message.length;\n    }\n  });\n  return { wordCount, totalCharacters };\n}\n\nconst buildCols = (wordCount) => {\n  const cols = Object.keys(wordCount).map(x => ({\n    field: x,\n    headerName: x === '' ? 'Total' : x,\n    width: 100\n  }));\n  return [{ field: 'word', headerName: 'Word', width: 100 }, ...cols];\n}\n\nconst buildWordCountArray = (wordCount) => {\n  let wordCountArray = {};\n  for (let [key, value] of Object.entries(wordCount)) {\n    wordCountArray[key] = [];\n    for (let [word, count] of Object.entries(value))\n      wordCountArray[key].push([word, count]);\n  }\n  return wordCountArray;\n}\n\nconst buildWordsInTable = (wordCountArray) => {\n  let wordsInTable = {};\n  for (let [key, value] of Object.entries(wordCountArray)) {\n    value.sort((a, b) => b[1] - a[1]);\n    wordsInTable[key] = value.slice(0, WORDS_IN_TABLE_PER_SENDER).map(x => x[0]);\n  }\n  return wordsInTable;\n}\n\nconst doFilterMostCommon = (wordsInTable, wordCountArray) => {\n  // if at least 80% of senders has that word in its top half then it is  \n  // considered a common word and thus removed\n  // or we filter it even if it is a one or two letter word\n  const commonWord = () => {\n    const nSenders = Math.max(2, Math.trunc(Object.keys(wordsInTable).length * 0.8));\n    const commonWords = Object.keys(wordsInTable)\n      .flatMap(sender => wordsInTable[sender].slice(0, Math.trunc(WORDS_IN_TABLE_PER_SENDER / 2)));\n    let count = {};\n    commonWords.forEach(val => count[val] = (count[val] || 0) + 1);\n    for (let [word, c] of Object.entries(count)) {\n      if (c >= nSenders || word.length <= 2) {\n        return word;\n      }\n    }\n    return \"\";\n  };\n  let w = commonWord(wordsInTable);\n  let i = 0;\n  while (w) {\n    for (let [key, value] of Object.entries(wordCountArray)) {\n      wordsInTable[key].splice(wordsInTable[key].indexOf(w), 1);             // remove common\n      if (WORDS_IN_TABLE_PER_SENDER + i < value.length)\n        wordsInTable[key].push(value[WORDS_IN_TABLE_PER_SENDER + (i++)][0]); // add new\n    }\n    w = commonWord(wordsInTable);\n  }\n  return wordsInTable;\n}\n\nconst wordCountToTable = (wordCount, totalCharacters, filterMostCommon) => {\n  const wordCountArray = buildWordCountArray(wordCount);\n  const wordsInTablePreliminary = buildWordsInTable(wordCountArray);\n  const wordsInTable = filterMostCommon ? doFilterMostCommon(wordsInTablePreliminary, wordCountArray)\n    : wordsInTablePreliminary;\n\n  const mergedWordsInTable = [...new Set(Object.keys(wordsInTable).flatMap(k => wordsInTable[k]))];\n  let rows = [];\n  mergedWordsInTable.forEach(word => {\n    let row = { id: word, word };\n    Object.keys(wordsInTable).forEach(sender => row[sender] = wordCount[sender][word] ? wordCount[sender][word] : 0);\n    Object.keys(wordsInTable).forEach(sender => row[sender] /= totalCharacters[sender] / 5);\n    rows.push(row);\n  });\n\n  rows.sort((a, b) => b[''] - a['']);\n  rows = rows.slice(0, WORDS_IN_TABLE_TOTAL);\n\n  return rows;\n}\n\nconst MostUsedWords = ({ textDf }) => {\n  const [filterMostCommon, setFilterMostCommon] = useState(false);\n  const { wordCount, totalCharacters } = textDfToWordCount(textDf);\n  const rows = wordCountToTable(wordCount, totalCharacters, filterMostCommon);\n  const cols = buildCols(wordCount);\n  return (\n    <React.Fragment>\n      <Divider style={{ marginTop: 10, marginBottom: 10 }} />\n      <Grid container justifyContent=\"space-between\">\n        <Grid item>\n          <Grid container>\n            <Typography variant=\"h6\">\n              Most Used Words\n            </Typography>\n            <Tooltip title={<ul><li>Toggle the button to filter out from the table the most used words and leave the one characterizing each sender</li><li>The numbers in the table represent the relative frequency of the word for that sender</li></ul>}>\n              <IconButton size=\"small\">\n                <HelpIcon />\n              </IconButton>\n            </Tooltip>\n          </Grid>\n        </Grid>\n        <Grid item>\n          <ToggleButton selected={filterMostCommon} size=\"small\"\n            value={filterMostCommon}\n            onClick={() => setFilterMostCommon(f => !f)}\n          >\n            Filter Out Most Common\n          </ToggleButton>\n        </Grid>\n      </Grid>\n      <DataGrid\n        style={{ maxHeight: 500 }}\n        rows={rows}\n        columns={cols}\n        pageSize={rows.length}\n        density=\"compact\"\n        disableSelectionOnClick\n        components={{\n          Toolbar: CustomToolbar,\n        }}\n      />\n    </React.Fragment>\n  );\n}\n\nexport default MostUsedWords;"],"names":["CustomToolbar","_jsxs","GridToolbarContainer","children","_jsx","GridToolbarColumnsButton","color","GridToolbarFilterButton","style","GridToolbarDensitySelector","GridToolbarExport","wordCountToTable","wordCount","totalCharacters","filterMostCommon","wordCountArray","_i","_Object$entries","Object","entries","length","_Object$entries$_i","_slicedToArray","key","value","_i2","_Object$entries2","_Object$entries2$_i","word","count","push","buildWordCountArray","wordsInTablePreliminary","wordsInTable","_i3","_Object$entries3","_Object$entries3$_i","sort","a","b","slice","map","x","buildWordsInTable","commonWord","nSenders","Math","max","trunc","keys","commonWords","flatMap","sender","WORDS_IN_TABLE_PER_SENDER","forEach","val","_i4","_Object$entries4","_Object$entries4$_i","w","i","_i5","_Object$entries5","_Object$entries5$_i","splice","indexOf","doFilterMostCommon","mergedWordsInTable","_toConsumableArray","Set","k","rows","row","id","_ref","textDf","_useState","useState","_useState2","setFilterMostCommon","_textDfToWordCount","message","type","words","split","toLowerCase","filter","textDfToWordCount","cols","field","headerName","width","concat","buildCols","React","Divider","marginTop","marginBottom","Grid","container","justifyContent","item","Typography","variant","Tooltip","title","IconButton","size","HelpIcon","ToggleButton","selected","onClick","f","DataGrid","maxHeight","columns","pageSize","density","disableSelectionOnClick","components","Toolbar"],"sourceRoot":""}